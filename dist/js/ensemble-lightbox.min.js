/*!
 * loltgt ensemble.Lightbox
 *
 * @version 0.0.1
 * @copyright Copyright (C) Leonardo Laureti
 * @license MIT License
 */
"use strict";!function(e,t,i,n){const s=n?n.Modal:i("../ensemble-modal/Modal");class o extends s{_defaults(){return Object.assign(super._defaults(),{selector:"",contents:null,navigation:!0,captioned:!0,infinite:!0,autoDiscover:!0,autoHide:"navigation",overlayed:!1,checkOrigin:!0,prev:{onclick:this.prev,innerText:"<",ariaLabel:"Previous"},next:{onclick:this.next,innerText:">",ariaLabel:"Next"},onStep:function(){},onSlide:function(){},onCaption:function(){}})}_bindings(){super._bindings(),this.add=this.binds(this.add),this.remove=this.binds(this.remove),this.prev=this.binds(this.prev),this.next=this.binds(this.next)}generator(){const e=super.generator(),t=this.cnt,i=this.options,n=this.gallery=this.compo("gallery");if(t.append(n),e.classList.add(i.ns+"-lightbox"),i.navigation){var s=this.nav=this.data();const e=s.wrap=this.compo("nav"),t=s.prev=this.compo("button","prev",i.prev),n=s.next=this.compo("button","next",i.next);e.append(t),e.append(n)}if(i.captioned){var o=this.captions=this.data();o.wrap=this.compo("captions")}if(i.overlayed){const t=i.overlayed.toString().match(/captions|navigation/);e.classList.add(i.ns+"-overlayed"),t&&e.classList.add(i.ns+"-overlayed-"+overlayed[0])}if(i.autoHide){const t=i.autoHide.toString().match(/captions|navigation/);e.classList.add(i.ns+"-autohide"),t&&e.classList.add(i.ns+"-autohide-"+t[0])}i.windowed?(i.navigation&&t.append(s.wrap),i.captioned&&t.append(o.wrap)):(i.navigation&&e.append(s.wrap),i.captioned&&e.append(o.wrap))}populate(e){console.log("populate",e);const t=this.options;let i;t.contents&&"object"==typeof t.contents?i=t.contents:t.selector&&(i=this.selector(t.selector,this.element,!0)),i=this.contents=this.prepare(i);for(const t of i){const n=this.content(t);e&&e===n.ref&&(this.index=i.indexOf(n),this.current=n),this.add(n)}this.current=this.current||i[0],this.index=this.index||0,this.slide(0),t.navigation&&this.navigation(),t.captioned&&this.caption()}resume(e){console.log("resume",e);const t=this.options,i=this.contents;for(const t of i)t.wrap.hide(),e&&e===t.ref&&(this.index=i.indexOf(t),this.current=t);this.current=this.current||i[0],this.index=this.index||0,this.slide(0),t.navigation&&this.navigation(),t.captioned&&this.caption()}content(t,i){const n=this.options,s=this.compo("object");var o;s.hide();const a=(o="string"==typeof t?this.data({src:t}):t).src;let r=o.type;r&&(r=r.match(/(^image|video|audio)|(pdf$)/),r=r?r[0]:"");const c=/^https?:\/\//.test(a);let p,d=!1;if(n.autoDiscover&&a&&!r&&(/\.jpg|\.jpeg|\.png|\.apng|\.gif|\.webp|\.avif|\.bmp|\.svg$/i.test(a)?r="image":/\.pdf$/.test(a)?r="pdf":/\.mp4|\.webm|\.ogv|\.m4v|\.hevc|\.ivf|\.obu|\.ismv|\.mkv$/i.test(a)?r="video":/\.mp3|\.opus|\.ogg|\.m4a|\.aac|\.flac|\.wav|\.weba|\.mka$/i.test(a)?r="audio":/^data:image\/jpeg|png|apng|gif|webp|avif|bmp|svg\+xml/.test(a)&&(d=!0,r="image")),"pdf"===r&&(r="iframe",p="pdf"),n.checkOrigin&&a&&c&&!d){("null"!=e.origin?e.origin:e.location.origin)!=new URL(a).origin&&(r="")}if(a&&!r)if("#"===a[0]){const e=this.selector(a);e&&(o.node=e,r=/iframe|img|picture|video|audio/i.test(e.nodeName)?/img|picture/i.test(e.nodeName)?"image":e.nodeName.toLowerCase():"element")}else r="iframe";"element"===r&&(i=void 0!==i?i:n.cloning,o.node=i?this.cloneNode(o.node,!0):o.node),o.ref=o.ref||null,o.type=r,o.src=a,n.onContent.call(this,this,o),r&&s.classList.add(n.ns+"-"+r),p&&s.classList.add(n.ns+"-"+p);const h=this.inner(o);return o.fresh=function(){o.node&&o.inner.inject(o.node),o.wrap.show()},o.stale=function(){o.node&&o.inner.empty(),o.wrap.hide()},o.wrap=s,o.inner=o.compo(h.tag,h.name,h.props,!0,o.fresh,o.stale),o}inner(e){let t=e.type,i=!0,n={};for(const t in e)/ref|src|type|sources|subtitles|children/.test(t)||"_"==t[0]||(n[t]=e[t]);switch(e.src&&(n.src=e.src),e.type){case"image":if(t="img",e.sources||e.children)if(t="picture",n.children=[],e.sources&&"object"==typeof e.source)for(const t of e.sources)n.children.push({tag:"source",name:!0,props:t});else if(e.children&&e.children.length)for(const t of e.children){const e=t.tagName.toLowerCase();"source"==e&&"img"==e&&n.children.push({tag:e,name:!0,props:t.attributes})}break;case"video":case"audio":if(n.controls=!e.controls||e.controls,n.children=[],e.sources&&"object"==typeof e.sources){for(const t of e.sources)n.children.push({tag:"source",name:!0,props:t});if(e.subtitles&&"object"==typeof e.subtitles)for(const t of e.subtitles)n.children.push({tag:"track",name:!0,props:t})}else if(e.children&&e.children.length)for(const t of e.children){const e=t.tagName.toLowerCase();"source"==e&&"track"==e&&n.children.push({tag:e,name:!0,props:t.attributes})}break;case"iframe":if(n.frameBorder=0,!n.src)return null;break;default:t="div",i="custom-element"}return{tag:t,name:i,props:n}}prepare(e){const t=[];if(e&&"object"==typeof e&&e.length)for(const i of e)if("object"==typeof i&&"nodeName"in i){const e=this.data(),n=i.dataset;if(Object.assign(e,n),e.ref=i,n.sources)try{e.sources=JSON.parse(n.sources)}catch{}if(i.href)e.src=i.href;else if(n.href)e.src=n.href;else if(/iframe|img|picture|video|audio/i.test(i.nodeName)){const t=i.nodeName.toLowerCase();/img|picture/.test(t)?e.type="image":e.type=t,"iframe"!=t&&i.children&&i.children.length&&(e.children=i.children)}else e.type="element",e.node=i;n.caption&&(e.caption=n.caption),t.push(e)}else"string"==typeof i?t.push(i):"type"in i&&/(^element|iframe|image|video|audio|pdf)/.test(i.type)?t.push(this.data(i)):t.push(this.data());return t}add(e){this.gallery.append(e.wrap),this.options.navigation&&this.navigation()}remove(e){this.gallery.remove(e.wrap),this.options.navigation&&this.navigation()}prev(e){this.event(e),this.slide(-1)}next(e){this.event(e),this.slide(1)}slide(e){const t=this.options;if(!t.infinite&&0!=this.way&&this.way===e)return;const i=this.contents;let n=this.index,s=this.current,o=s;if(t.onStep.call(this,this,s,e),0!=e){const t=i.length-1,a=-1===e?i[n-1]:i[n+1],r=-1===e?i[t]:i[0];o=a||r,n=a?-1===e?n-1:n+1:-1===e?t:0,s.stale("inner")}if(!t.infinite){let e=0;o.wrap.previous?o.wrap.next||(e=1):e=-1,this.way=parseInt(e),t.navigation&&this.navigation(e)}o.render("inner"),o.wrap.append(o.inner),t.onSlide.call(this,this,s,e,s.wrap!=o.wrap?o.wrap:null),this.delay((function(){0!=e&&s.wrap.remove(s.inner)}),s.wrap),this.index=n,this.current=i[n],t.captioned&&this.caption()}navigation(e){const t=this.nav;if(this.contents.length>1){if(t.wrap.show(),!this.options.infinite&&void 0!==e)switch(e){case-1:t.prev.disable(),t.next.enable();break;case 1:t.prev.enable(),t.next.disable();break;default:t.prev.enable(),t.next.enable()}}else t.wrap.hide()}caption(e){const t=this.options,i=this.captions,n=this.current;if(i.wrap.empty(),!t.onCaption(this,this,n,e)){if(!e)if(n.caption)e=n.caption;else if(t.selector){const t=n.ref;if(this.hasAttr(t,"title"))e=this.getAttr(t,"title");else if("image"===n.type){e=this.selector("img",t).alt}}if(e){e=e.split(/\n\n|\r\n\r\n/);for(const t of e){const e=this.compo("p",!0,{innerText:t});i.wrap.append(e)}}}}keyboard(e){super.keyboard(e);switch(e.keyCode||0){case 37:this.prev(e);break;case 39:this.next(e)}}}e.ensemble={...n,Lightbox:o},t.exports=o}("undefined"!=typeof window?window:{},"undefined"!=typeof module?module:{},"undefined"!=typeof require?require:function(){},globalThis.ensemble);
//# sourceMappingURL=ensemble-lightbox.min.js.map
